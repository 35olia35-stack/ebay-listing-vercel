<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Seller Listing Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/x-icon" href="/favicon-32.ico">


<style>
*{box-sizing:border-box}
html, body{
  width:100%;
  height:100%;
  margin:0;
  overflow:hidden;
  font-family:Inter,system-ui,sans-serif;
}

/* ===== FIXED BACKGROUND (NO WHITE EDGES) ===== */
.page{
  position:fixed;
  inset:0;
  background:url("hero-bg.jpg") center/cover no-repeat;
}

/* ===== WHITE TABLE ===== */
.form-wrap{
  position:absolute;
  top:50%;
  left:160px;
  transform:translateY(-50%);
  width:420px;
  background:#f5f7fa;
  border:1px solid rgba(0,0,0,0.04);
  display:flex;
  flex-direction:column;
}

/* ===== SCROLLABLE CONTENT ===== */
.form-scroll{
  padding:28px;
  overflow-y:auto;
  max-height:calc(100vh - 180px);
}

/* ===== FIXED FOOTER ===== */
.form-footer{
  padding:20px 28px;
  border-top:1px solid #e5e7eb;
  background:#f5f7fa;
}

/* ===== FORM ===== */
label{
  font-size:13px;
  font-weight:600;
  color:#374151;
  display:block;
  margin-bottom:6px;
}
.hint{
  font-size:12px;
  line-height:1.45;
  color:#64748b;
  margin-bottom:10px;
}
input, textarea, select{
  width:100%;
  margin-bottom:16px;
  padding:12px 14px;
  border-radius:4px;
  border:1px solid #cbd5e1;
  font-size:14px;
}
textarea{min-height:120px}

/* TEMPLATE SWITCH */
.templates{
  display:flex;
  gap:6px;
  margin-bottom:16px;
}
.templates label{flex:1;cursor:pointer}
.templates input{display:none}
.templates span{
  display:block;
  text-align:center;
  padding:10px 0;
  border:1px solid #cbd5e1;
  font-weight:600;
  font-size:13px;
  background:#ffffff;
}
.templates input:checked + span{
  background:#1c686c;
  color:#fff;
  border-color:#1c686c;
}

/* DETAILS */
details{margin-bottom:14px}
summary{
  cursor:pointer;
  font-weight:600;
  color:#1c686c;
  font-size:13px;
  margin-bottom:10px;
}

/* BUTTON */
button{
  width:100%;
  min-height:52px;
  background:#1c686c;
  color:#fff;
  border:0;
  font-size:16px;
  font-weight:700;
  cursor:pointer;

  /* для временных длинных сообщений */
  white-space:normal;
  line-height:1.25;
}
button:hover{background:#165c60}

/* ===== MOBILE ===== */
@media(max-width:900px){
  html, body{overflow:auto}
  .page{position:static;min-height:100vh;}
  .form-wrap{position:static;transform:none;margin:40px auto;}
  .form-scroll{max-height:none}
}

.loading{background:#3b82f6 !important; animation:pulse 1s infinite}

@keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}

</style>
<script defer src="/_vercel/insights/script.js"></script>

</head>

<body>
<div class="page">
<div class="form-wrap">
<div class="form-scroll">

<label>Describe your item</label>
<div class="hint">
The more information you provide, the better the result will be.<br>
You can simply copy an existing description from anywhere and paste it here.
</div>

<textarea
  id="mainText"
  placeholder="Vintage leather handbag, brown, multiple pockets, gold-tone hardware..."
></textarea>


<label>Listing style</label>
<div class="hint">
This affects layout and structure only. Content will be generated from your input.
</div>

<div class="templates">
  <label><input type="radio" name="tpl" value="classic" checked><span>Classic</span></label>
  <label><input type="radio" name="tpl" value="modern"><span>Modern</span></label>
  <label><input type="radio" name="tpl" value="seo"><span>SEO</span></label>
</div>

<label>Category</label>
<div class="hint">
Optional, but strongly recommended. Helps structure the listing and item specifics correctly.
</div>

<select id="category">
  <option value="">Select category</option>


  <optgroup label="Fashion">
    <option>Women’s Bags & Handbags</option>
    <option>Women’s Shoes</option>
    <option>Men’s Shoes</option>
    <option>Women’s Clothing</option>
    <option>Men’s Clothing</option>
    <option>Fashion Accessories</option>
  </optgroup>

  <optgroup label="Electronics">
    <option>Cell Phones & Accessories</option>
    <option>Computers, Tablets & Networking</option>
    <option>Consumer Electronics</option>
  </optgroup>

  <optgroup label="Home & Garden">
    <option>Home Décor</option>
    <option>Kitchen, Dining & Bar</option>
    <option>Furniture</option>
  </optgroup>

  <optgroup label="Collectibles & Art">
    <option>Collectibles</option>
    <option>Art</option>
    <option>Antiques</option>
  </optgroup>

  <optgroup label="Other">
    <option>Health & Beauty</option>
    <option>Sporting Goods</option>
    <option>Toys & Hobbies</option>
    <option>Automotive</option>
  </optgroup>
</select>

<details>
  <summary>Item details</summary>
  <input id="brand" placeholder="Brand">
  <select id="condition">
    <option>New</option>
    <option>Pre-owned</option>
  </select>
  <input id="model" placeholder="Model">
  <input id="material" placeholder="Material">
  <input id="color" placeholder="Color">
  <input id="features" placeholder="Features">
</details>

<details>
  <summary>Shipping & Delivery</summary>
  <input id="handling_time" placeholder="Handling time (e.g. 1 business day)">
  <input id="ships_from" placeholder="Ships from">
  <input id="estimated_delivery" placeholder="Estimated delivery">
</details>


</div>

<div class="form-footer">
<button type="button" id="generateBtn">Generate preview</button>
</div>

</div>
</div>

<script>
// ===== Free session state (MVP, client-side) =====
const MAX_FREE = 50;
const BTN_DEFAULT = 'Generate preview';
const MSG_DELAY = 2000; // время показа сообщения на кнопке
const btn = document.getElementById('generateBtn');


let genState = JSON.parse(localStorage.getItem('genState')) || {
  count: 0,
  tipShown: false,
  resetAt: Date.now() + 24 * 60 * 60 * 1000
};


function saveState(){
  localStorage.setItem('genState', JSON.stringify(genState));
}
// --- auto reset after 24h ---
if (genState.resetAt && Date.now() > genState.resetAt) {
  genState = {
    count: 0,
    tipShown: false,
    resetAt: Date.now() + 24 * 60 * 60 * 1000
  };
  saveState();
}

  
// ===== Phases =====
function getPhase(count){
  if (count <= 30) return 1;
  if (count <= 40) return 2;
  if (count <= 47) return 3;
  if (count <= 50) return 4;
  return 5;
}

// ===== Temporary button message =====

// ===== Phase message resolver =====
function getPhaseMessage(phase){
  // Фаза 2 — Tip (один раз)
  if (phase === 2 && !genState.tipShown) {
    genState.tipShown = true;
    saveState();
    return 'Tip: if you like a result, keep this tab open while refining.';
  }

  // Фаза 3
  if (phase === 3) {
    return 'You’re close to finishing your free session.';
  }

  // Фаза 4
  if (phase === 4) {
    return 'If you’re close to a version you like, this is a good moment to finalize or download.';
  }

  return null;
}

// ===== After successful generation =====

document.getElementById('generateBtn').addEventListener('click', () => {
function getGenLeft() {
  const raw = localStorage.getItem('genLimit');

  // Новый пользователь / новое устройство
  if (raw === null) {
    localStorage.setItem('genLimit', '50');
    return 50;
  }

  const n = Number(raw);
  return Number.isFinite(n) && n >= 0 ? n : 50;
}

  const btn = document.getElementById('generateBtn');
// ===== PayPal return handler =====
if (new URLSearchParams(location.search).get('paid') === '1') {
 localStorage.setItem('paidToken', '1');
 localStorage.setItem('genLimit', '50');
  history.replaceState({}, '', location.pathname);

  // если платили из preview — вернуться обратно
  if (sessionStorage.getItem('returnToPreview') === '1') {
    sessionStorage.removeItem('returnToPreview');
    window.location.href = '/preview.html';
  }
}

  // HARD STOP before generation (51+)
const left = getGenLeft();

if (left <= 0) {
  btn.textContent = 'Come back tomorrow';
  btn.disabled = true;
  btn.title = "You've reached today's free limit.";
  return;
}

  

const tpl = document.querySelector('input[name="tpl"]:checked')?.value;
  if (!tpl) return;
// --- показать фазовую фразу СРАЗУ ---
const nextCount = genState.count + 1;
const nextPhase = getPhase(nextCount);
const instantMsg = getPhaseMessage(nextPhase);

if (instantMsg) {
  btn.textContent = instantMsg;
}
btn.disabled = true;
btn.classList.add('loading');


const category = document.getElementById('category').value;
const mainText = document.getElementById('mainText').value.trim();


fetch('/api/generate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
  tpl,
  category,
  mainText,
  brand: document.getElementById('brand').value.trim(),
  condition: document.getElementById('condition').value,
  model: document.getElementById('model').value.trim(),
  material: document.getElementById('material').value.trim(),
  color: document.getElementById('color').value.trim(),
  features: document.getElementById('features').value.trim(),
  handling_time: document.getElementById('handling_time').value.trim(),
  ships_from: document.getElementById('ships_from').value.trim(),
  estimated_delivery: document.getElementById('estimated_delivery').value.trim()
})

})
.then(async (res) => {
  if (!res.ok) throw new Error('API error: ' + res.status);

  const json = await res.json();
  localStorage.setItem('listingData', JSON.stringify(json));
localStorage.setItem('genLimit', String(Number(localStorage.getItem('genLimit')) - 1));

  genState.count++;
  saveState();

  const phase = getPhase(genState.count);
  const msg = getPhaseMessage(phase);
  const finalMsg = msg || 'Preparing preview...';

  btn.textContent = finalMsg;
  btn.disabled = true;

  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      setTimeout(() => {
        const isFacebook = /FBAN|FBAV|Instagram/i.test(navigator.userAgent);

if (isFacebook) {
  window.location.href = '/preview.html';
} else {
  window.open('/preview.html', '_blank');
}




       // DEV MODE: disable daily limit
// FINAL: enforce daily limit
btn.classList.remove('loading');

if (genState.count >= MAX_FREE) {
  btn.textContent = 'Come back tomorrow';
  btn.disabled = true;
  btn.title = "You've reached today's free limit.";
} else {
  btn.textContent = BTN_DEFAULT;
  btn.disabled = false;
}


      }, MSG_DELAY);
    });
  });
})
.catch(err => {
  console.error(err);
  alert('AI generation failed. Check Console.');
});


});
</script>

</body>

</html>



















